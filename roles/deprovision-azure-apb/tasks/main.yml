##############################################################################
## Deprovision azure
## This role executes much of the needed functionality to deprovision an
## application using an Ansible Playbook Bundle and delete resources created
## in the sample apb generated by the provision role.
##############################################################################

      #- name: Load Azure connection secret
      #  include_vars:
      #    file: '/etc/apb-secrets/apb-azure-auth'
      #  ignore_errors: yes   

      - name: Delete virtual machine
        azure_rm_virtualmachine:
          resource_group: '{{ azure_resource_group }}'
          name: '{{ azure_vm_name  }}'
          client_id: '{{ client_id }}'
          secret: '{{ secret }}'
          subscription_id: '{{ subscription_id }}'
          tenant: '{{ tenant }}'
          state: absent
            
      - name: Delete NIC
        azure_rm_networkinterface:
          resource_group: '{{ azure_resource_group }}'
          name: '{{ azure_nic_name  }}'
          client_id: '{{ client_id }}'
          secret: '{{ secret }}'
          subscription_id: '{{ subscription_id }}'
          tenant: '{{ tenant }}'
          state: absent

